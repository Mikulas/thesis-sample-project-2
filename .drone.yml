kind: pipeline
name: default

steps:
- name: build
  image: composer:1.8
  volumes:
  - name: vendor
    path: /drone/src/vendor
  commands:
  - make build

- name: deploy
  image: eeacms/rsync:1.2
  environment:
    SSH_KEY:
      from_secret: deploy-ssh-key
  volumes:
  - name: vendor
    path: /drone/src/vendor
  commands:
  - mkdir -p /root/.ssh
  - echo "$SSH_KEY" | base64 -d > /root/.ssh/id_rsa
  - chmod go-rwx /root/.ssh/id_rsa
  - apk add --no-cache bash make
  - ssh -o StrictHostKeyChecking=no www-data@webserver-plain whoami
  - make deploy

volumes:
- name: site
  temp: {}

---
kind: secret

# cat src/cookbooks/ssh-ring/files/id_rsa | base64 | xargs drone encrypt root/project-1
data:
  deploy-ssh-key: 1psu0UpAraP04l3a9ZmWS4WO00C7zOYxFYx1Y8Q9ErHidSgIKmZHaKhHcV9k0gra6pH0Bv7HfgRD424ZZ2QmucYw3K_0pRYS8xFRCziOW2Uxj4UbIEKR9jJbogAwhWWmfd6wJLIvsTbZtugkMYPKkfSxI_abBGAG8d_LpAISI3zSWzJG5yIbCE3i5Zyg7WadDilN6zlon9z2SHGymzpadKJC9fyIZmrh60KJ7pKSoaCiFSr0lPydGK-j4gvKgEoSaULtDPjy9Vzu9gu4fQkXABIIXBrUUDpf1dJbR2QwItiWLoldd76uIV6OhlLAZd2pOVa_pILEs2PbsOpmb2lcoHYskondR7VyVnn-gernsDRPPAoj7lN19C8o-oJitpdtY-sMwrr7FwPx91DmUHYQ2p0lcV1BfZfgCPMO8CWIBI32ZFgsYjY4QzQA75B9GZGyjXXLwaj_wq2Z3GbRwiWy7q2dfxNdts1-C7YsOUNrSyfFDwo8yBZKnLmIhSc3o6TEyYoJwWflPlOVmeg14qq7Nq2ZdTfFh4I7mWQwadKvZW4Qvn0N_FvMa5T6lV6KAtjD6FigLrFKl_a56iVliqcS9Jia4hy3Ldsu6sWs7SOXf1anhWPEoHWMMoOXbX2dBD-MSottAQgyhTYObtD02eweFCgx5qSlPGezu2oBxSU2RYDppqQtKRD7YllmfLHJ1Y5Q_K42HIUoOjwTgd1Qlp8nTFtrIQoHzNM6sFc42-3XazzJGOrc8CxE4HOORMu8YKD7KTKs6H-hc5S9YBl6fjLNzqnKvOsrea1yMBdtgu-V1cWQOtNDyTWb6ttRZ4RlzzX_Tlk2laitHV6mUMed3eJOfnDOxArztlAMOZi9EvltetF8Dst26NZdNOx7I3JqOHv6OcFlNNgu66rdDe2Me1dtVnxb2aqhdZOnT9DnK8RL3S4PlkBkyPJ2a1v8Z4LBh731q1bwFtAb5itvTLuTqTtVkLB81z63-3RZNrDNCx0-LHGLJrFZW6Nz8eu3USDiw33nHUa71EA5xhNYCuYkwxTchPRwa7xCjjpKQPZenA7T1syHKFnBzZkOxS4EwKMbbjY1aDzInjALzNDViGQGXUmuw0YuXIvF4Vy8Zk53SpHO5nXg83KBgcifBNVPuUtlsu8CfOFrr34Qykn5DtjiJIRtIYcZyO0ki8eaGTuwn9Vc-0HdHq4lPVV36lZNZGSTSw2QF54IHw2AfpRjL8WyYne-CLZ5FR4bIsJZjpZmUI_ClWxko3IU5fHn6eaceu0xV1tBER2LPxBnbOIfgtBCMdCzIwwvMkCd0O-byKW3cEAWHPrgp8IUwYS0i9l0TOLjOH-Rl5uSXjvOzT9SoIpDEJlqpIdPpxEpUe9T4t2ajivX9b3wr1w2_jmTbS2UExaxSgngm18GwdMUv7cx0Fvh-1UaLoOg5AWYBYRaJS5fp-S3ounMh5rtthFNWCcfNebVB2iGtcjbuXac1EP7Lhoz5VHKETisYdcdmFy7uf2ab8d5sQcHXLiooAvw71JcBgz3zI26Wh2aLLfJbwauhEPH8ziT5ib3m6TAIbIHXMcupCCrJqBIQTxvb6_Krk5EBaZdcFa8D_sCESgs6xbEpKpucuRarjqlKXC2gFJ-fSBZ2TMBE6dlfAKFc5cjhziReO_XO5chqRC97GOWP9ijDRwcsnUuO6LLIyzdgdoBfmVpKo39qdhksu6JElCnKQ-MYZ043Ab1KQ91a9yDfafutg9T3XKMQnQzCI3Xk0GTp9YtNgeFYZMVGmr-3kMYHnJmJm6REBCGbFZj-KzNJyfBKn3eqT6D2hOEyUH6MpMvjqBK0aTGzxAJe2srM9HzWolfxQwTxTy0J-Dpgxq2sHfosyZLTo-OlNN2dJq3iqmdbvvUH02c__Z0i4vKhsxrzaFFHWQ9O9VAUGlXgxNg-OOFY-a3KHoHlIRc89UA3Qh6gIjaa5iLNbG5MRJwvLdFXUxavecahTNm3gQ-BOawtZH_ATZXdrJSntfGlmZ5z8YsUVeWWY1jzywvUWe9qdR_lpNFncIZBjCENbeRxJZa0ab7r6LoBTs7rcWZdAXUeMjXe6vCtOglWoPyojPq_u7iARiBCed0gZcx2OKWbp9gxyDV27Pf6WKNlGYSOGsiCwoWX0JAXRQpXYQEJjCdFw5g8-BGfT3OCASGR6lAGpM8NuAqyB6ifsZQeE5mqtLIjzOa_p4brwGzFL7zw2hXrDSIxZ_yYiMXC_oj-MN4_fuksvybjym_Y_wl7SQjM9oNTUqacGdGvz2SzTX442fVf_4jCOrxFKWucmJWxbaARI4TjpirqnfFmT0YVpjGLUTWvQ-eB-0wnnff9NEdf9MhWK-NtqCPFeQ-goJ1EQGNbzIuTeIpK6G-NM0c2ZpjElhyUs_BwdckUNlU8CQAotRcEOq-16nLl0ZHvXx0cS4MbYWQvTEnOP6FipzLlx82tyhA8ttlhz9Mgc6r5fNQ9NvXqbK9mLivqnfAVoFYxVceZaAu3Un4zawDz33Fej5wM_KxqudNv7dT1JYBDyUXylO4BeVFU5iBzBYxHtPjjJBN0n2I_HY7Opb33bpnc__KbPjRQgYo9tWo-r26fkSEl51igmRpw34SyJg7rVQXLc1H5QGmZlcICdWWhLVsuHQGOZUv1HdRrLDSpKh5iG0mmOylMwoP6640exJMSXnS1aLwNC5LQ9h0ejgWRfaK7GMFmcj23Wjc2ukpaNE17WoLL07fmlNoMPHSw7YmC6HpMFtXOMPIbLMcTvAFKZCARrNDOH1sTwih07fEsAC4SoCVTiHeWy-fU5UA9m9SI32seWnpldZcdDASy-VaucB7xDfgRjEUY4tnEmbX-GF9aPZdWyYeZO-St4TBrmg7xTD0qkugLpOwAlzOiRIokCmPlQib-WiXz0ORkLgzwql00uenxU9oQ-7rExBK0mGmz6dwmL_H9fc62jLnm0ahWik-VjwEHS6uUJWt3k_hkFo3eIjyZkobWEqMmRIXd5ECcUcj0_yafU6PZyQmmbPdNHFnIOpe_2ocjeBxyquoqJdndfpRR_KCCpKRiFV0jdHntQws4aSFUStqmzzKP-QgvgODyT-qwqNX2iHZktPLXZjOUrUiR8hOnTgod3X3UuCkg7aWtbWs_NvvcF5Gq0mh5doCyKC6Vys9MzAGewgHEeibgzjtyieWMDO7zWTLk2QyhKnW97lS_kytu9L-MQseh1VbLeEljhN8PGyJb3guOME6ixsWYpbVf3I17_BnFoOS2VAW5aMD1hVPjHXqtfwzV0CvqOuL78_0SHY-H0qFHY3WbfbnLxDiD3n-Xh9Cme5v3-xSAp5COQm82Ske7DycVzpUJKKYf-cwQ9PIqGiOMmEEP-gBRJ6sh7gJQracgetoHotpCFxqG_80v0ItKiFpPjgo34tc3OXec-ejG8MIrmDwwtHgCg7mKGUCMdPXJkLYT0V_rw1HHiEBMAzG-PUv3P7keJjsOOE_uSn2yAypRW2jOFbP0gWb_lRO6RDzvahDT0qiU79m-_SxtcGc32Vu-vDdxgmYpY7w10q1J-anuVLkm8Na9Use9YMTHvTc63F3ol7lHg6W__DdCpi5TQFGfqWEVWXl8V9uEL1kxMp6qhFGVCewOINsCt1QXVqNejujvfOf11WhUrg_PNqSqemgjqwIwGkZtSLQBW_v3PmThpa1gyiT27IbK2bSdU9dGf5EunDQcURlIm79GFnCqzDefMPgCgUNphY3MYIC3-ok669pAAjkDHHJ7mYjmbcb8bX4LLboJ3VrxvNnwS97y60eHpARpr3oyTe825-NSQ-Ae_-vDQobVUSNebGUB_e7Ki-SHFm0gjLRjqxXq2-ra9unKnJIk3rv70YznO4w3sykbakXksX-EkJ4lR_js_zOkMSUt2LZEA2jWiaTcJ-Q6w_qYX8Fx2DHFqUJ9cGsL0DXfRk0yq0oWs-9v4GWKym6iRFG_-jc8_VJA1P2qwBw8AN9HH7kSYwGvEp40hwhgB40AH5i0XjCNQ3EYAIs1cz8EDHdXju8YL9rwHXwDF3VSPBQKfE9a2hO1UXWkgX3OW6Y5Nf-AWsq4DEkSA5sacALdp8-y0HArsvDfRTXM2Yn4ADaJIurnLvjHof3f3fgs0-Zcavsye1HT7Wl3N-oE338j7wo6mBM-r6gL0dGWNNTSd7JCKrlVcTbVzYDvzIMHoN0-CDWRkNLdeakWPiyzaXH6b48RMvDISugAJc2OI_YOKOLYNcz-OYAot2Au623x5s_mt8_L_jcHStAdFTSuTW3_fsUgc7Qr-VLcx9oEucpqX9AoAjBaWrnFwRiInoX_V7QPIRFdETizoHiKjn-c-kKT6e95oiYgoM6OEvu0e2ptavyitE7xkVzDMdXkunIqcUe68uoDOlFRW88gQut2J7IGIxqsB7jaAr1-F4c6mJXxRNEwkX4crQyVcg483H0Di9Wdd_ygzsvkcLooAbveRWJzbsNaQHP9pLrYhQU0UsTnE69a_EwBpwVsnJQPnMeWu4F1P2vqd2GCKLdbh4FcVTHiE9rgLhK7oU54Hkb706Qxbnh5HxxvStsNApeNUpRT-QS0iG71YvEvRjR7_GmCqbfraZgz3gqPnVEdpLwQ5OEUjjJaOw_yxG3MtYPJh6bBZbMrz57bxrW5Av2CngafZ6dM3Gaae4resqUdYFTMpxtS992q7ktElr97mXZLfPn0K0ZLVZhCNjRoC45eX8WnriPHtm2G6Uetsbc5q-D9jgoCxIMkp7DC6T96lCKbAUPwtFuJwScv9zVup1d81Mg2J-hyQaOf9s8Xt4jcve2Gzzbppby0bhn8I0-IMlAv1vfPhM_pMo4aad9Qh4NuMsIF-t8HOKhS7UgTwlBGMrAonX6Jx7rF9GkwUVxMfU_7Xqf6QGYIV6T0heHM8Z1xmHEkoPUbkByA-lhHZD1n0oH3PNQfwnkdI4X-Row34nWj-jJ56c3hee6fBC2c8FJ2pCiuGaSoPcXFk536pUWzifDauaKCpBDmxKeVPbeUzgDPtFaf8DU5nV-THQW_SpII3GyQPMKyAqM8zuZeQS6InudQ67-ZMXQsUVmsZKjIVkSCOXvLgzR7ViggpIHYUbz8MdLoeIiGxEH0L1oyn9UGOiHfCtJHgSza7bFawfnbOmmAfrDpQynnoPXdei5Gek3dYrnHYm1FMC9gqrruAxankvTFXVRQpEuNZGzG0xTG5NGREmOZDjisntM573GQb-LenwldzuCLr-DO1xa82sFSclvV7WTOUq1ZKhKkCgM-L4GWY3xNozHo7jd5i1D2T-fgc_VX8AI1K0hiBFpiRPyZxsz1KCdWmBjXJEl19LGdy18IfQWRctE6syoMx1hWD74rSA6LK0Xhw2YiIjLToWBM8knAM7UcdaoLWzyDW-pFvNvkBX8FaoINxfw50SibzsXlB6lbRCRJihUQfaJkOPa_CO9tpwG13OvCIY9tWaOoD_l2ayL_4Nc10MQwtQ1PtlugDO7A_NqLi9jgduGU3kpZSsNl5Xp_hL1xjjaM_UQaVE4J3GADpZbn7du9DWrO_KnPT4Yl2yjRBHCfJgggi8h0sk_SaOsHdYKvvxrMKpD5Y2DBv5_KPzbkXbUOJYAZVAdhK_9GAOXN-EePKGDloMVct72U843C5bbR5hqW-_yABSNDq3nZxjaLI812AiCRT_DVfivfUGhgBwJmU4yQ7jExZuWaKDzsWT_wI8-3aoR4WkoRbbku0gKDIiKCRUySQpIOB2E9YeyZ9nmsg8ceBz8n-Mhob2xalqM1ifuq0GUunesGddWKzOQDtVV-KwlNc7HVAPma6wNCPmxre97xKkaPZ0hmfWLSAgBe0SgvmuqLEFZQsP_jYyAb_IUmYAMM5egr1vigZdnXoKqaVDqDD2EcZiBeVBMFyELlDuMIMro-ZerZHYfV0ctQuq0HngICq2p5rE99_cCowmj7ZmpN-AbkJzxtQcqh4XQ1AeVyig4Su-r_sgjnc8llSARn_gcA6TIrovrWeoQY_8IppTr7rUZQymK1tB05qVGu_ru4DrkBcwyylfNYBHl6oNCcxb2fUTkXmc-MoYqhIMk5IU=
